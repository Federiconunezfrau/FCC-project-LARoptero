#include "circularBuffer.h"

void circularBuffer_constructor(circularBuffer_t *me, uint8_t *buf, uint8_t size)
{
    me->mBuf_ = buf;
    me->mSize_ = size;
    me->mWrite_ = 0;
    me->mRead_ = 0;
}

/**
 * @Brief Toma como parametro el buffer cicular y devuelve el tamanio util para escribir
 * @param Buffer
 * @return 
 */
uint8_t circularBuffer_length_data(circularBuffer_t* me)
{
    uint8_t length = 0;
    length = ((Buffer->write - Buffer->read) & (Buffer->size - 1));
    return length;
}

/**
 * @Brief Escribe en el buffer "Buffer" el dato "data"
 * @param Buffer
 * @param data
 * @return 
 */
ErrorBuffer BufferWrite(CircularBuffer* Buffer, uint8_t data)
{
    if(BufferLenghtData(Buffer) == Buffer->size - 1)
    {
        return ErrorBufferFull;
    }
    
    Buffer->buf[Buffer->write] = data;
    Buffer->write = (Buffer->write +1) & (Buffer->size -1);
    return NoErrorBuffer;
}

/**
 * @Brief Lee del buffer "Buffer" el dato "data"
 * @param Buffer
 * @param data
 * @return 
 */
ErrorBuffer BufferRead(CircularBuffer* Buffer, uint8_t *data)
{
    uint8_t length = 0;
    
    length = BufferLenghtData(Buffer);
    //if(BufferLenghtData(Buffer) == 0)
    if(length == 0)
    {
        return ErrorBufferEmpty;
    }
    
    *data = Buffer->buf[Buffer->read];
    Buffer->read = (Buffer->read + 1) & (Buffer->size -1);
    return NoErrorBuffer;
}




